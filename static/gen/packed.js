document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".delete-log-btn").forEach(button=>{button.addEventListener("click",function(){let logId=this.getAttribute("data-log-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_logs_route/${logId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".itexmo-log-btn").forEach(button=>{button.addEventListener("click",function(){let itexmoId=this.getAttribute("data-log-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_itexmo/${itexmoId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".email-log-btn").forEach(button=>{button.addEventListener("click",function(){let emailId=this.getAttribute("data-log-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_email_route/${emailId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hris-log-btn").forEach(button=>{button.addEventListener("click",function(){let hrisId=this.getAttribute("data-log-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_hrpears_route/${hrisId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".login-log-btn").forEach(button=>{button.addEventListener("click",function(){let loginId=this.getAttribute("data-log-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_loginapi_route/${loginId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".user-log-btn").forEach(button=>{button.addEventListener("click",function(){let userId=this.getAttribute("data-log-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_user_route/${userId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".role-log-btn").forEach(button=>{button.addEventListener("click",function(){let roleId=this.getAttribute("data-log-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_role_route/${roleId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".division-log-btn").forEach(button=>{button.addEventListener("click",function(){let divisionId=this.getAttribute("data-log-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_division_route/${divisionId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".msg-btn").forEach(button=>{button.addEventListener("click",function(){let msglogId=this.getAttribute("data-log-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_msglogs_route/${msglogId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".msg_temp-btn").forEach(button=>{button.addEventListener("click",function(){let msgTempId=this.getAttribute("data-msgtemp-id");if(confirm("Are you sure?")){let form=document.createElement("form");form.method="POST";form.action=`/delete_msg_temp_route/${msgTempId}`;document.body.appendChild(form);form.submit();}});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".edit_email-btn").forEach(button=>{button.addEventListener("click",function(){let emid=this.getAttribute("data-emid");let ename=this.getAttribute("data-name");let email=this.getAttribute("data-email");let sender=this.getAttribute("data-sender");let password=this.getAttribute("data-password");document.getElementById("ecreds_id").value=emid;document.getElementById("ecreds_name").value=ename;document.getElementById("ecreds_email").value=email;document.getElementById("ecreds_sender").value=sender;document.getElementById("ecreds_password").value=password;document.getElementById("email_editForm").action=`/edit_email_route/${emid}`;new bootstrap.Modal(document.getElementById("email_edit")).show();});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".edit_hris-btn").forEach(button=>{button.addEventListener("click",function(){let hrid=this.getAttribute("data-hrid");let hrname=this.getAttribute("data-hrname");let host=this.getAttribute("data-host");let root=this.getAttribute("data-root");let user=this.getAttribute("data-user");let password=this.getAttribute("data-password");let db=this.getAttribute("data-db");let table=this.getAttribute("data-table");document.getElementById("hrpears_id").value=hrid;document.getElementById("hrpears_name").value=hrname;document.getElementById("hrpears_host").value=host;document.getElementById("hrpears_root").value=root;document.getElementById("hrpears_user").value=user;document.getElementById("hrpears_password").value=password;document.getElementById("hrpears_dbname").value=db;document.getElementById("hrpears_table").value=table;document.getElementById("hris_editForm").action=`/edit_hrpears_route/${hrid}`;new bootstrap.Modal(document.getElementById("hris_edit")).show();});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".edit_itexmo-btn").forEach(button=>{button.addEventListener("click",function(){let txtid=this.getAttribute("data-txtid");let txtname=this.getAttribute("data-txtname");let txturl=this.getAttribute("data-txturl");let txtemail=this.getAttribute("data-txtemail");let txtpassword=this.getAttribute("data-txtpassword");let txtapicode=this.getAttribute("data-txtapicode");let txtcontenttype=this.getAttribute("data-txtcontenttype");document.getElementById("itexmo_id").value=txtid;document.getElementById("itexmo_name").value=txtname;document.getElementById("itexmo_url").value=txturl;document.getElementById("itexmo_email").value=txtemail;document.getElementById("itexmo_password").value=txtpassword;document.getElementById("itexmo_apicode").value=txtapicode;document.getElementById("itexmo_contenttype").value=txtcontenttype;document.getElementById("itextmo_editForm").action=`/edit_itexmo_route/${txtid}`;new bootstrap.Modal(document.getElementById("itextmo_edit")).show();});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".edit_login-btn").forEach(button=>{button.addEventListener("click",function(){let logid=this.getAttribute("data-logid");let logname=this.getAttribute("data-logname");let logurl=this.getAttribute("data-logurl");let logtoken=this.getAttribute("data-logtoken");let logcontenttype=this.getAttribute("data-logcontenttype");document.getElementById("login_api_id").value=logid;document.getElementById("login_api_name").value=logname;document.getElementById("login_api_url").value=logurl;document.getElementById("login_api_token").value=logtoken;document.getElementById("login_api_content_type").value=logcontenttype;document.getElementById("login_editForm").action=`/edit_loginapi_route/${logid}`;new bootstrap.Modal(document.getElementById("login_edit")).show();});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".edit_user-btn").forEach(button=>{button.addEventListener("click",function(){let uid=this.getAttribute("data-uid");let fname=this.getAttribute("data-fname");let rid=this.getAttribute("data-rid");document.getElementById("user_id").value=uid;document.getElementById("full_name").value=fname;document.getElementById("role_id").value=rid;document.getElementById("user_editForm").action=`/edit_user_route/${uid}`;new bootstrap.Modal(document.getElementById("user_edit")).show();});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".edit_role-btn").forEach(button=>{button.addEventListener("click",function(){let rid=this.getAttribute("data-rid");let rname=this.getAttribute("data-rname");let rdesc=this.getAttribute("data-rdesc");document.getElementById("role_id").value=rid;document.getElementById("role_name").value=rname;document.getElementById("role_description").value=rdesc;document.getElementById("role_editForm").action=`/edit_role_route/${rid}`;new bootstrap.Modal(document.getElementById("role_edit")).show();});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".edit_division-btn").forEach(button=>{button.addEventListener("click",function(){let did=this.getAttribute("data-did");let dname=this.getAttribute("data-dname");let ddesc=this.getAttribute("data-ddesc");document.getElementById("division_id").value=did;document.getElementById("division_name").value=dname;document.getElementById("division_description").value=ddesc;document.getElementById("division_editForm").action=`/edit_division_route/${did}`;new bootstrap.Modal(document.getElementById("division_edit")).show();});});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".edit_msg_temp-btn").forEach(button=>{button.addEventListener("click",function(){let mtid=this.getAttribute("data-mtid");let mtname=this.getAttribute("data-mtname");let mtdesc=this.getAttribute("data-mtdesc");document.getElementById("msg_temp_id").value=mtid;document.getElementById("msg_temp_name").value=mtname;document.getElementById("msg_temp_description").value=mtdesc;document.getElementById("msgTemp_editForm").action=`/edit_msg_temp_route/${mtid}`;new bootstrap.Modal(document.getElementById("msg_temp_edit")).show();});});});document.addEventListener("DOMContentLoaded",function(){let phoneInput=document.getElementById("phone");let emailInput=document.getElementById("email");let sendingOptionSelect=document.getElementById("sending_option");function toggleRequiredFields(){let sendingOption=sendingOptionSelect.value;phoneInput.removeAttribute("required");emailInput.removeAttribute("required");if(sendingOption==="sms"){phoneInput.setAttribute("required","required");}else if(sendingOption==="email"){emailInput.setAttribute("required","required");}else if(sendingOption==="both"){phoneInput.setAttribute("required","required");emailInput.setAttribute("required","required");}}
toggleRequiredFields();sendingOptionSelect.addEventListener("change",toggleRequiredFields);});document.addEventListener("DOMContentLoaded",function(){let cache={};let directoryTypeElement=document.getElementById("directory-type");let initialType=directoryTypeElement.value;fetchAndDisplayData(initialType);document.querySelectorAll(".directory-btn").forEach(button=>{button.addEventListener("click",function(){let modal=new bootstrap.Modal(document.getElementById("foxDirectoryModal"));modal.show();let directoryType=directoryTypeElement.value;fetchAndDisplayData(directoryType);directoryTypeElement.removeEventListener("change",onDirectoryTypeChange);directoryTypeElement.addEventListener("change",onDirectoryTypeChange);});});function onDirectoryTypeChange(){let selectedType=this.value;document.getElementById("searchBar").value="";fetchAndDisplayData(selectedType);}
function fetchAndDisplayData(type){let tableBody=document.getElementById("directoryTable");if(cache[type]){console.log(`Using cached data for ${type}`);displayData(cache[type]);return;}
tableBody.innerHTML='<tr><td colspan="3">Loading...</td></tr>';let endpoint=type==="external"?"/display_eprocsys_data":"/display_hrpears_data";fetch(endpoint).then(response=>response.json()).then(data=>{cache[type]=data;displayData(data);}).catch(error=>{console.error("Error fetching data:",error);tableBody.innerHTML='<tr><td colspan="3">Failed to load data</td></tr>';});}
function displayData(data){let tableBody=document.getElementById("directoryTable");tableBody.innerHTML="";data.forEach(row=>{let tr=document.createElement("tr");tr.classList.add("clickable-row");tr.dataset.name=row.name;tr.dataset.mobile=row.mobile_no;tr.dataset.email=row.email;tr.innerHTML=`<td>${row.name}</td><td>${row.mobile_no}</td><td>${row.email}</td>`;tableBody.appendChild(tr);});addRowClickEvent();}
function addRowClickEvent(){document.querySelectorAll(".clickable-row").forEach(row=>{row.addEventListener("click",function(){document.getElementById("recipient").value=this.dataset.name;document.getElementById("phone").value=this.dataset.mobile;document.getElementById("email").value=this.dataset.email;});});}});document.addEventListener("DOMContentLoaded",function(){const searchBar=document.getElementById("searchBar");searchBar.addEventListener("keyup",function(){let searchValue=searchBar.value.toLowerCase();let tableRows=document.querySelectorAll("#directoryTable tr");tableRows.forEach(row=>{let name=row.dataset.name?row.dataset.name.toLowerCase():"";let mobile=row.dataset.mobile?row.dataset.mobile.toLowerCase():"";let email=row.dataset.email?row.dataset.email.toLowerCase():"";if(name.includes(searchValue)||mobile.includes(searchValue)||email.includes(searchValue)){row.style.display="";}else{row.style.display="none";}});});});document.getElementById("stemplate").addEventListener("change",function(){let s_selectedOption=this.options[this.selectedIndex];let s_description=s_selectedOption.getAttribute("data-descS")||"";document.getElementById("message").value=s_description;});document.addEventListener('DOMContentLoaded',function(){const form=document.getElementById('send_single_msg');const spinner=document.getElementById('singleloadingSpinner');const submitBtn=document.getElementById('submitBtnSingle');const formFieldsWrapper=document.querySelector('.form-fields-wrapper');if(form){form.addEventListener('submit',function(){spinner.classList.remove('d-none');submitBtn.disabled=true;if(formFieldsWrapper){formFieldsWrapper.style.display='none';}
sessionStorage.setItem('showResultModal','true');});}
const shouldShowModal=sessionStorage.getItem('showResultModal')==='true';if(typeof singletotalSent!=='undefined'&&singletotalSent!==null&&typeof singletotalUnsent!=='undefined'&&singletotalUnsent!==null&&shouldShowModal){const icon=document.getElementById('singleresultIcon');const messageText=document.getElementById('singleresultMessage');icon.textContent=singletotalUnsent===0?'✅':'❌';messageText.textContent=`Sent:${singletotalSent},Unsent:${singletotalUnsent}`;const resultModal=new bootstrap.Modal(document.getElementById('singleresultModal'));resultModal.show();sessionStorage.removeItem('showResultModal');}});document.addEventListener("DOMContentLoaded",function(){let cache={};let directoryTypeElement=document.getElementById("mdirectory-type");let initialType=directoryTypeElement.value;fetchAndDisplayData(initialType);document.querySelectorAll(".multi_directory-btn").forEach(button=>{button.addEventListener("click",function(){let modal=new bootstrap.Modal(document.getElementById("multi_foxDirectoryModal"));modal.show();let directoryType=directoryTypeElement.value;fetchAndDisplayData(directoryType);directoryTypeElement.removeEventListener("change",onDirectoryTypeChange);directoryTypeElement.addEventListener("change",onDirectoryTypeChange);});});function onDirectoryTypeChange(){let selectedType=this.value;document.getElementById("msearchBar").value="";fetchAndDisplayData(selectedType);}
function fetchAndDisplayData(type){let tableBody=document.getElementById("mdirectoryTable");if(cache[type]){console.log(`Using cached data for ${type}`);displayData(cache[type]);return;}
tableBody.innerHTML='<tr><td colspan="4">Loading...</td></tr>';let endpoint=type==="external"?"/display_eprocsys_data":"/display_hrpears_data";fetch(endpoint).then(response=>response.json()).then(data=>{cache[type]=data;displayData(data);}).catch(error=>{console.error("Error fetching data:",error);tableBody.innerHTML='<tr><td colspan="4">Failed to load data</td></tr>';});}
function displayData(data){let tableBody=document.getElementById("mdirectoryTable");tableBody.innerHTML="";let list=document.getElementById("mlist").value.split("\n");data.forEach(row=>{let entry=`${row.name}:${row.mobile_no}:${row.email}`;let checked=list.includes(entry)?"checked":"";let tr=document.createElement("tr");tr.classList.add("mclickable-row");tr.dataset.name=row.name;tr.dataset.mobile=row.mobile_no;tr.dataset.email=row.email;tr.innerHTML=`<td><input type="checkbox"class="row-checkbox"${checked}></td><td>${row.name}</td><td>${row.mobile_no}</td><td>${row.email}</td>`;tableBody.appendChild(tr);});addRowClickEvent();addCheckboxChangeEvent();}
function addRowClickEvent(){document.querySelectorAll(".mclickable-row").forEach(row=>{row.addEventListener("click",function(event){if(!event.target.classList.contains("row-checkbox")){document.getElementById("mrecipient").value=this.dataset.name;document.getElementById("mphone").value=this.dataset.mobile;document.getElementById("memail").value=this.dataset.email;}});});}
function addCheckboxChangeEvent(){document.querySelectorAll(".row-checkbox").forEach(checkbox=>{checkbox.addEventListener("change",function(){let list=document.getElementById("mlist");let row=this.closest("tr");let entry=`${row.dataset.name}:${row.dataset.mobile}:${row.dataset.email}`;let entries=list.value?list.value.split("\n"):[];if(this.checked){if(!entries.includes(entry)){entries.push(entry);}}else{entries=entries.filter(e=>e!==entry);}
list.value=entries.join("\n");});});}
document.addEventListener("click",function(event){if(event.target.classList.contains("msend")){let list=document.getElementById("mlist");let selectedEntries=[];document.querySelectorAll(".row-checkbox:checked").forEach(checkbox=>{let row=checkbox.closest("tr");let entry=`${row.dataset.name}:${row.dataset.mobile}:${row.dataset.email}`;selectedEntries.push(entry);});if(selectedEntries.length>0){list.value=selectedEntries.join("\n");}else{list.value="";}
document.querySelectorAll(".row-checkbox").forEach(checkbox=>{checkbox.checked=false;});}});});function addRecipient(){let recipient=document.getElementById("mrecipient").value.trim();let mobile=document.getElementById("mphone").value.trim();let email=document.getElementById("memail").value.trim();let list=document.getElementById("mlist");if(recipient===""||mobile===""||email===""){alert("Please fill in all fields before adding.");return;}
let entry=`${recipient}:${mobile}:${email}`;list.value=list.value?list.value+"\n"+entry:entry;document.getElementById("mrecipient").value="";document.getElementById("mphone").value="";document.getElementById("memail").value="";}
document.addEventListener("DOMContentLoaded",function(){const searchBar=document.getElementById("msearchBar");searchBar.addEventListener("keyup",function(){let searchValue=searchBar.value.toLowerCase();let tableRows=document.querySelectorAll("#mdirectoryTable tr");tableRows.forEach(row=>{let name=row.dataset.name?row.dataset.name.toLowerCase():"";let mobile=row.dataset.mobile?row.dataset.mobile.toLowerCase():"";let email=row.dataset.email?row.dataset.email.toLowerCase():"";if(name.includes(searchValue)||mobile.includes(searchValue)||email.includes(searchValue)){row.style.display="";}else{row.style.display="none";}});});});document.getElementById("mtemplate").addEventListener("change",function(){let m_selectedOption=this.options[this.selectedIndex];let m_description=m_selectedOption.getAttribute("data-descM")||"";document.getElementById("mmessage").value=m_description;});document.addEventListener('DOMContentLoaded',function(){const form2=document.getElementById('send_multi_msg');const spinner2=document.getElementById('multiloadingSpinner');const submitBtn2=document.getElementById('submitBtnMulti');const formFieldsWrapper2=document.querySelector('.form-fields-wrapper2');const formFieldsWrapper3=document.querySelector('.form-fields-wrapper3');if(form2){form2.addEventListener('submit',function(){spinner2.classList.remove('d-none');submitBtn2.disabled=true;if(formFieldsWrapper2){formFieldsWrapper2.style.display='none';}
if(formFieldsWrapper3){formFieldsWrapper3.style.display='none';}
sessionStorage.setItem('showResultModal','true');});}
const shouldShowModal2=sessionStorage.getItem('showResultModal')==='true';if(typeof multitotalSent!=='undefined'&&multitotalSent!==null&&typeof multitotalUnsent!=='undefined'&&multitotalUnsent!==null&&shouldShowModal2){const icon2=document.getElementById('multiresultIcon');const messageText2=document.getElementById('multiresultMessage');icon2.textContent=multitotalUnsent===0?'✅':'❌';messageText2.textContent=`Sent:${multitotalSent},Unsent:${multitotalUnsent}`;const resultModal2=new bootstrap.Modal(document.getElementById('multiresultModal'));resultModal2.show();sessionStorage.removeItem('showResultModal');}});document.addEventListener("DOMContentLoaded",function(){document.getElementById("searchIcon").addEventListener("click",function(){let fileInput=document.getElementById("uploaded");let file=fileInput.files[0];if(!file){alert("Please upload a file first.");return;}
let formData=new FormData();formData.append("uploaded",file);fetch("/generate_from_upload",{method:"POST",body:formData}).then(response=>response.json()).then(data=>{console.log("Response from Flask:",data);let formattedRecords=data.matched_records.map(record=>{return`${record.fullname}:${record.mobile}:${record.email}:${record.amount}\n`;}).join("");let displayRecords=data.matched_records.map(record=>{return`${record.fullname}:->${record.amount}\n`;}).join("");document.getElementById("udisplaydata").value=displayRecords||"No data found";document.getElementById("ufounddata").value=formattedRecords||"No data found";document.getElementById("unodatafound").value=data.unmatched_names.join("\n");}).catch(error=>console.error("Error:",error));});});document.getElementById("utemplate").addEventListener("change",function(){let u_selectedOption=this.options[this.selectedIndex];let u_description=u_selectedOption.getAttribute("data-descU")||"";document.getElementById("umessage").value=u_description;});document.addEventListener('DOMContentLoaded',function(){const form3=document.getElementById('send_upload_msg');const spinner3=document.getElementById('uploadloadingSpinner');const submitBtn3=document.getElementById('submitBtnUpload');const formFieldsWrapper4=document.querySelector('.form-fields-wrapper4');const formFieldsWrapper5=document.querySelector('.form-fields-wrapper5');if(form3){form3.addEventListener('submit',function(){spinner3.classList.remove('d-none');submitBtn3.disabled=true;if(formFieldsWrapper4){formFieldsWrapper4.style.display='none';}
if(formFieldsWrapper5){formFieldsWrapper5.style.display='none';}
sessionStorage.setItem('showResultModal','true');});}
const shouldShowModal3=sessionStorage.getItem('showResultModal')==='true';if(typeof uploadtotalSent!=='undefined'&&uploadtotalSent!==null&&typeof uploadtotalUnsent!=='undefined'&&uploadtotalUnsent!==null&&shouldShowModal3){const icon3=document.getElementById('multiresultIcon');const messageText3=document.getElementById('multiresultMessage');icon3.textContent=uploadtotalUnsent===0?'✅':'❌';messageText3.textContent=`Sent:${uploadtotalSent},Unsent:${uploadtotalUnsent}`;const resultModal3=new bootstrap.Modal(document.getElementById('multiresultModal'));resultModal3.show();sessionStorage.removeItem('showResultModal');}});document.addEventListener("DOMContentLoaded",function(){var popoverTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));popoverTriggerList.forEach(function(popoverTriggerEl){var popover=new bootstrap.Popover(popoverTriggerEl,{trigger:"hover",placement:"bottom",container:"body"});});});document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){let flashMessages=document.querySelectorAll(".flash-message");flashMessages.forEach(msg=>msg.style.display="none");},5000);});document.addEventListener("DOMContentLoaded",function(){document.addEventListener("hidden.bs.modal",function(){document.querySelectorAll(".modal-backdrop").forEach(backdrop=>{backdrop.remove();});document.body.classList.remove("modal-open");});});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".submit-btn").forEach(button=>{button.addEventListener("click",function(){let themeId=this.getAttribute("data-theme-id");document.getElementById("theme_id").value=themeId;document.getElementById("themeForm").action=`/select_theme/${themeId}`;document.getElementById("themeForm").submit();});});});