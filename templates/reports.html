{% extends "base.html" %}



{% block title %}
Reports - FO-X NotiFS
{% endblock %}
{% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reports.css') }}">
{% endblock %}



{% block content %}
<div class="row g-0 p-0 m-0">
    <div class="col-auto">
    </div>
    <div class="col">
        <div class="container-fluid main_container">
            <div class="row first_row {{user.theme.theme_bg}} {{user.theme.theme_font}}">
                <div class="row service-row">
                    {% if user.is_authenticated and user.role_id in [1,3] %}
                        <div class="col service-col">
                            <div class="row">
                                <h1 class="number_headings">{{ "{:,}".format(total_credit_used) }}</h1>
                            </div>
                            <div class="row">
                                <h5>{{ to_block_text("Notifs")}} Credit/s used</h5>
                            </div>
                        </div>
                    {% endif %}
                    <div class="col service-col">
                        <div class="row">
                            <h1 class="number_headings">{{ "{:,}".format(user_credit) }}</h1>
                        </div>
                        <div class="row">
                            <h5>{{ to_block_text("User")}} Credit/s used</h5>
                        </div>
                    </div>
                    <div class="col service-col">
                        <div class="row">
                            <h1 class="number_headings">{{ "{:,}".format(total_credits_used) }}</h1>
                        </div>
                        <div class="row">
                            <h5>{{ to_block_text("Total")}} Credit/s used</h5>
                        </div>
                    </div>
                    <div class="col service-col">
                        <div class="row">
                            <h1 class="number_headings">{{ "{:,}".format(total_credits_remaining) }}</h1>
                        </div>
                        <div class="row">
                            <h5>{{ to_block_text("Remaining")}} Credit/s</h5>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row second_row">
                <div class="col div_col {{user.theme.theme_bg}} {{user.theme.theme_font}}"  >
                    <div class="col-md-8">
                        <canvas id="creditBarChart"></canvas>
                    </div>
                </div>
                <div class="col div_col {{user.theme.theme_bg}} {{user.theme.theme_font}}">
                    div col 2
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Confirm Chart.js is loaded
    if (window.Chart) {
        console.log('Chart.js is loaded successfully. Version:', Chart.version);
    } else {
        console.error('Chart.js failed to load.');
    }
    
    // Select the canvas element
    const canvas = document.getElementById('creditBarChart');
    if (!canvas) {
        console.error('Canvas with ID "creditBarChart" not found. Please check your HTML.');
    } else {
        try {
        const ctx = canvas.getContext('2d');
        const labels = {{ division_labels | tojson | safe }};
        const data = {{ division_values | tojson | safe }};
    
        console.log('Labels:', labels);
        console.log('Data:', data);
    
        if (labels.length === 0 || data.length === 0) {
            console.warn('No data available for the chart.');
        } else {
            // Create the Chart
            new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                label: 'Credits Used',
                data: data,
                backgroundColor: [
                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                ],
                borderColor: '#000000',
                borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                y: {
                    beginAtZero: true
                }
                }
            }
            });
            console.log('Chart rendered successfully!');
        }
        } catch (error) {
        console.error('Error rendering chart:', error);
        }
    }
    
</script>

{% endblock %}
