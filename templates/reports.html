{% extends "base.html" %}
    {% block title %}
        Reports - FO-X NotiFS
    {% endblock %}
    {% block css %}
        <link rel="stylesheet" href="{{ url_for('static', filename='css/reports.css') }}">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% endblock %}
    {% block content %}
        <div class="row g-0 p-0 m-0">
            <div class="col-auto">
            </div>
            <div class="col">
                <div class="container-fluid main_container">
                    <div class="row first_row {{user.theme.theme_bg}} {{user.theme.theme_font}}">
                        <div class="row service-row">
                            {% if user.is_authenticated and user.role_id in [1,3] %}
                                <div class="col service-col">
                                    <div class="service-info">
                                        <img class="setting_icon" src="{{ url_for('static', filename='images/'+user.theme.theme_icon+'/global/info.svg') }}" 
                                            alt="settings"
                                            data-bs-toggle="popover"
                                            data-bs-placement="top"
                                            data-bs-content="Total SMS credits used by the Notification Service.">
                                    </div>
                                    <div class="row">
                                        <h1 class="number_headings">{{ "{:,}".format(total_credit_used) }}</h1>
                                    </div>
                                    <div class="row">
                                        <h5>{{ to_block_text("Notifs")}} Credit/s used</h5>
                                    </div>
                                </div>
                            {% endif %}
                            <div class="col service-col">
                                <div class="service-info">
                                    <img class="setting_icon" src="{{ url_for('static', filename='images/'+user.theme.theme_icon+'/global/info.svg') }}" 
                                        alt="settings"
                                        data-bs-toggle="popover"
                                        data-bs-placement="top"
                                        data-bs-content="Total SMS credits used by the User.">
                                </div>
                                <div class="row">
                                    <h1 class="number_headings">{{ "{:,}".format(user_credit) }}</h1>
                                </div>
                                <div class="row">
                                    <h5>{{ to_block_text("User")}} Credit/s used</h5>
                                </div>
                            </div>
                            <div class="col service-col">
                                <div class="service-info">
                                    <img class="setting_icon" src="{{ url_for('static', filename='images/'+user.theme.theme_icon+'/global/info.svg') }}" 
                                        alt="settings"
                                        data-bs-toggle="popover"
                                        data-bs-placement="top"
                                        data-bs-content="Total SMS credits used by DSWD FOX, this includes other systems using the SMS API service.">
                                </div>
                                <div class="row">
                                    <h1 class="number_headings">{{ "{:,}".format(total_credits_used) }}</h1>
                                </div>
                                <div class="row">
                                    <h5>{{ to_block_text("Total")}} Credit/s used</h5>
                                </div>
                            </div>
                            <div class="col service-col">
                                <div class="service-info">
                                    <img class="setting_icon" src="{{ url_for('static', filename='images/'+user.theme.theme_icon+'/global/info.svg') }}" 
                                        alt="settings"
                                        data-bs-toggle="popover"
                                        data-bs-placement="top"
                                        data-bs-content="Total remaining SMS credits for DSWD FOX.">
                                </div>
                                <div class="row">
                                    <h1 class="number_headings">{{ "{:,}".format(total_credits_remaining) }}</h1>
                                </div>
                                <div class="row">
                                    <h5>{{ to_block_text("Remaining")}} Credit/s</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row second_row">
                        <div class="col div_col {{user.theme.theme_bg}} {{user.theme.theme_font}}">
                            <div class="col service-col2">
                                <canvas id="myChart" width="700" height="450" style="width:100%;max-width:700px;"></canvas>
                            </div>
                        </div>
                        <div class="col div_col {{user.theme.theme_bg}} {{user.theme.theme_font}}">
                            <div class="col service-col2">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% block scripts %}
        <script>
            const divisionData = JSON.parse('{{ division_data | tojson | safe }}');
            const labels = Object.keys(divisionData);
            const dataValues = Object.values(divisionData);
        
            const ctx = document.getElementById('myChart').getContext('2d');
            const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                label: 'Credits Used by Division',
                data: dataValues,
                backgroundColor: 'rgba(255, 1, 17, 0.6)',
                borderColor: 'rgb(123, 3, 13)',
                borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                    color: '#ccc',    // Grid color
                    lineWidth: 2       // Thicker grid lines
                    },
                    ticks: {
                    color: '#000',    // Y-axis label color
                    font: {
                        size: 14,
                        weight: 'bold'
                    }
                    }
                },
                x: {
                    grid: {
                    color: '#ccc',    // Grid color
                    lineWidth: 2       // Thicker grid lines
                    },
                    ticks: {
                    color: '#000',    // X-axis label color
                    font: {
                        size: 14,
                        weight: 'bold'
                    }
                    }
                }
                },
                plugins: {
                legend: {
                    labels: {
                    color: '#333',
                    font: {
                        size: 14,
                        weight: 'bold'
                    }
                    }
                }
                }
            }
            });
        </script>
        {% endblock %}
    {% endblock %}


