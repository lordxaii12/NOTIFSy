
<style>
    .scrollable-modal-body {
        max-height: 60vh; /* adjust this to your desired height */
        overflow-y: auto;
        margin-top: 20px;
    }
    .user_search-bar{
        width: 100% !important;
        padding: 8px;
        margin-top: 20px;
        border: 1px solid #ccc;
        background-color: rgb(229, 228, 228);
        border-radius: 5px;
        font-size: 14px;
        outline: none;

    }
</style>

<div class="modal fade" id="userDirectoryModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="userDirectoryModallabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content {{user.theme.theme_bg}} {{user.theme.theme_font}}">
            <div class="modal-header {{user.theme.theme_font}}">
                <h5 class="modal-title" id="userDirectoryModallabel">FOX-Users</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="directory-content {{user.theme.theme_font}}">
                    <input type="text" placeholder="Search..." class="user_search-bar" id="searchBar">
                    <div class="table-responsive scrollable-modal-body">
                        <table class="table table-bordered table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Name</th>
                                </tr>
                            </thead>
                            <tbody id="userdirectoryTable">
                                
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>















<script>
    document.addEventListener("DOMContentLoaded", function () {
        let cache = {};
    
        // Initial fetch
        fetchAndDisplayData();
    
        // Show modal and fetch data on button click
        document.querySelectorAll(".user_directory-btn").forEach(button => {
            button.addEventListener("click", function () {
                let modal = new bootstrap.Modal(document.getElementById("userDirectoryModal"));
                modal.show();
                fetchAndDisplayData(); // No type needed
            });
        });
    
        function fetchAndDisplayData() {
            let tableBody = document.getElementById("userdirectoryTable");
    
            if (cache["data"]) {
                console.log("Using cached data");
                displayData(cache["data"]);
                return;
            }
    
            tableBody.innerHTML = '<tr><td colspan="3">Loading...</td></tr>';
    
            fetch("/display_users_data") // Just one endpoint now
                .then(response => response.json())
                .then(data => {
                    cache["data"] = data;
                    displayData(data);
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                    tableBody.innerHTML = '<tr><td colspan="3">Failed to load data</td></tr>';
                });
        }
    
        function displayData(data) {
            let tableBody = document.getElementById("userdirectoryTable");
            tableBody.innerHTML = "";
    
            data.forEach(row => {
                let tr = document.createElement("tr");
                tr.classList.add("clickable-row");
                tr.dataset.name = row.name;
                tr.dataset.username = row.username;
                tr.dataset.division = row.division;
                tr.dataset.section = row.section;
                tr.innerHTML = `
                    <td>${row.name}</td>
                `;
                tableBody.appendChild(tr);
            });
    
            addRowClickEvent();
        }
    
        function addRowClickEvent() {
            document.querySelectorAll(".clickable-row").forEach(row => {
                row.addEventListener("click", function () {
                    // Hide directory modal
                    bootstrap.Modal.getInstance(document.getElementById("userDirectoryModal")).hide();
    
                    // Wait for a short delay to ensure transition is smooth
                    setTimeout(() => {
                        // Show the example modal
                        const formModal = new bootstrap.Modal(document.getElementById("addUserModal"));
                        formModal.show();
    
                        // Populate form fields
                        document.getElementById("ufull_name").value = this.dataset.name;
                        document.getElementById("uusername").value = this.dataset.username;
                        document.getElementById("udivision").value = this.dataset.division;
                        document.getElementById("usection").value = this.dataset.section;
                    }, 500);
                });
            });
        }
    });
</script>


<script>
</script>